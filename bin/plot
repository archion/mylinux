#!/bin/bash
#file=`basename "$1"`
#cd `dirname "$1"`
for f in "$@"
do
	file=${f##*/}
	cd ${f/$file/.}
	if ! [ -f "${file/.*}".plt ]; then
		if grep -q "#data" "$file"; then
			sed -n "0,/#data/p" "$file" >"${file/.*}".plt
		else
			cp gnuplot.plt "${file/.*}".plt
		fi
	fi
	sed -i "s/\"-\"/\"$file\"/g" "${file/.*}".plt
	sed -i "s/\"-\.\"/\"${file%.*}\.\"/g" "${file/.*}".plt
	if grep -q "#data" "$file"; then
		sed -i "0,/#data/s/^/#/" "$file"
	fi
	gnuplot -p "${file/.*}".plt
	if grep -q "##data" "$file" >/dev/null; then
		sed -i "0,/#data/s/^#//" "$file"
	fi
	sed -i "s/\"$file\"/\"-\"/g" "${file/.*}".plt
	sed -i "s/\"${file%.*}\.\"/\"-\.\"/g" "${file/.*}".plt
	#rm plot.plt
	if ! ps ax | grep -e "[z]athura.*"${file/.*}"\." > /dev/null && [ -f "${file/.*}".eps ]; then
		zathura "${file/.*}".eps &
		gvim -o "${file/.*}".plt "${file/.*}".dat
	fi
done
