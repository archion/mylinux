#!/bin/bash
if  ping -c 1 www.baidu.com &> /dev/null; then
	echo 已经联网
	exit
fi
if  ping -c 1 p.nju.edu.cn &> /dev/null; then
	while true;do
		echo 正在尝试联网...
		if curl -s --data "username=$1&password=$2&acctsessionid=`curl -s --data "username=$1&password=$2" http://p.nju.edu.cn/proxy/onlinelist.php | grep -o 'acctsessionid":"[0-9]*"'|grep -o '[0-9]*'`" http://p.nju.edu.cn/proxy/disconnect.php > /dev/null && curl -s --data "action=login&username=$1&password=$2" http://p.nju.edu.cn/portal/portal_io.do |grep -o "登录成功"; then
			break
		else
			echo 登录失败，等待重试...
			sleep 10
		fi
	done
else
	echo 无法链接内网，检查是否链接网线
	exit
fi
